<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>StreamBox – Dashboard</title>

  <!-- Supabase SDK v2 -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

  <!-- Styles -->
  <link rel="stylesheet" href="./style.css">

  <!-- PWA (relative paths for GitHub Pages) -->
  <link rel="manifest" href="./manifest.webmanifest">
  <link rel="apple-touch-icon" href="./icons/streambox-192.png">
  <meta name="theme-color" content="#f6f7fb">
</head>
<body>

  <!-- AUTH -->
  <div class="auth-wrap" id="auth-wrap">
    <div id="auth-box" class="card auth-card">
      <div class="brand" style="justify-content:space-between; width:100%;">
        <div style="display:flex;align-items:center;gap:10px">
          <div class="logo-dot"></div>
          <h1>StreamBox</h1>
        </div>
        <div class="row">
          <button id="btn-install-auth" type="button" style="display:none">Install</button>
          <button id="btn-theme-auth" type="button" title="Toggle theme">Theme</button>
        </div>
      </div>
      <div class="sub muted">Private archive. Secure access only.</div>

      <div class="auth-row">
        <input id="email" type="email" placeholder="Email" autocomplete="username">
        <input id="password" type="password" placeholder="Password" autocomplete="current-password">
      </div>
      <div class="auth-actions">
        <button id="btn-signin" class="primary" type="button">Sign In</button>
        <button id="btn-signup" type="button">Sign Up</button>
      </div>

      <div class="divider muted">or</div>
      <div class="oauth">
        <button id="btn-apple" class="btn-apple" type="button" title="Sign in with Apple">
          <svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18"><path d="M16.365 1.43c0 1.14-.47 2.23-1.23 3.06-.79.85-2.08 1.5-3.28 1.41-.13-1.11.41-2.27 1.17-3.07.83-.89 2.3-1.54 3.34-1.4zM20.5 17.17c-.64 1.44-1.41 2.86-2.54 4.05-1 .99-2.21 2.02-3.66 1.99-1.24-.03-1.63-.8-3.04-.8s-1.75.78-3.06.83c-1.45.05-2.56-1.07-3.56-2.06-1.94-1.93-3.44-5.44-2.8-8.45.31-1.44 1.18-2.75 2.47-3.55 1.1-.68 2.56-1 3.86-.81 1.01.15 1.95.66 2.63.66.66 0 1.86-.81 3.14-.69 1.07.11 2.07.44 2.92 1.07-1.73 1.15-1.51 3.58.27 4.53.79.42 1.72.51 2.6.27-.14.45-.3.9-.49 1.35z"/></svg>
          <span>Sign in with Apple</span>
        </button>
        <button id="btn-google" class="btn-google" type="button" title="Sign in with Google">
          <svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18"><path d="M21.35 11.1H12v2.9h5.32c-.23 1.5-1.75 4.4-5.32 4.4A6.2 6.2 0 0 1 5.8 12a6.2 6.2 0 0 1 6.2-6.4c1.77 0 2.96.75 3.64 1.4l2.48-2.39C16.7 3.2 14.6 2.3 12 2.3 6.97 2.3 2.9 6.37 2.9 11.4S6.97 20.5 12 20.5c7.03 0 8.1-5.93 7.95-9.4z"/></svg>
          <span>Sign in with Google</span>
        </button>
      </div>
    </div>
  </div>

  <!-- DASHBOARD -->
  <div id="app-box" class="shell" style="display:none">
    <div class="card topbar">
      <div><strong>StreamBox</strong> — <span id="user-email"></span></div>
      <div class="actions row">
        <button id="btn-install" type="button" style="display:none">Install</button>
        <button id="btn-files" type="button">Files</button>
        <button id="btn-trash" type="button">Trash</button>
        <button id="btn-cards" type="button">Cards</button>
        <button id="btn-rows" type="button">Rows</button>
        <button id="btn-profile" type="button">Profile</button>
        <button id="btn-theme" type="button" title="Toggle theme">Theme</button>
        <button id="btn-signout" type="button">Sign Out</button>
      </div>
    </div>

    <div class="dash">
      <!-- FOLDERS -->
      <aside class="card folders">
        <div class="folders-head">
          <h3>Folders</h3>
          <div class="row">
            <button id="btn-folder-new" type="button">New</button>
            <button id="btn-folder-rename" type="button">Rename</button>
            <button id="btn-folder-delete" type="button">Delete</button>
          </div>
        </div>
        <ul id="folder-list"></ul>
      </aside>

      <!-- MAIN -->
      <div class="card main">
        <div id="drop-area" class="drop">
          <p>Drag & drop files here or
            <a href="#" onclick="document.getElementById('fileElem').click();return false;">click to upload</a>
          </p>
          <input id="fileElem" type="file" multiple hidden onchange="handleFiles(this.files)">
        </div>

        <h3 id="section-title" style="margin:12px 0 4px">Your Files</h3>
        <ul id="file-list" class="grid"></ul>
      </div>
    </div>
  </div>

  <!-- PROFILE -->
  <div id="profile-box" class="shell" style="display:none">
    <div class="card" style="max-width:700px;margin:6vh auto;padding:16px">
      <h2>My Profile</h2>
      <p>Email: <strong id="profile-email"></strong></p>
      <div class="row" style="margin-top:8px">
        <input id="profile-name" type="text" placeholder="Full name">
        <input id="profile-birthday" type="date">
      </div>
      <div class="row" style="margin-top:10px">
        <button id="btn-save-profile" class="primary" type="button">Save</button>
        <button id="btn-back" type="button">Back</button>
      </div>

      <hr style="border-color:#e5e7eb; opacity:.6; margin:18px 0">

      <h3>Two-Factor Authentication (TOTP)</h3>
      <p class="muted">Use an authenticator app (1Password, Google Authenticator, Authy, etc.).</p>

      <div id="totp-setup" class="card" style="padding:12px; margin-top:10px;">
        <div id="totp-status" class="muted">Checking 2FA status…</div>
        <div id="totp-actions" style="margin-top:10px; display:flex; gap:10px; flex-wrap:wrap;">
          <button id="btn-2fa-enable" type="button" class="primary">Enable 2FA</button>
          <button id="btn-2fa-disable" type="button" style="display:none;">Disable 2FA</button>
        </div>

        <div id="totp-enroll" style="display:none; margin-top:12px;">
          <div class="row" style="align-items:flex-start;">
            <div style="flex:1;">
              <div class="muted">Scan this in your authenticator app:</div>
              <img id="totp-qr" alt="TOTP QR" style="margin-top:8px; width:180px; height:180px; border-radius:8px; border:1px solid #e5e7eb; background:#f9fafb; object-fit:contain;">
            </div>
            <div style="flex:2;">
              <div class="muted">Or enter the secret manually:</div>
              <input id="totp-secret" type="text" readonly style="margin-top:8px; width:100%;">
              <div class="row" style="margin-top:8px;">
                <input id="totp-code" type="text" placeholder="6-digit code" inputmode="numeric" pattern="[0-9]*" style="flex:1;">
                <button id="btn-2fa-verify" type="button" class="primary">Verify</button>
              </div>
              <div class="muted" style="margin-top:6px;">After verifying, 2FA is ON for your account.</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- MOVE MODAL -->
  <div id="move-overlay" class="overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="move-title">
      <h3 id="move-title">Move file</h3>
      <p id="move-file" class="muted" style="margin:0 0 8px"></p>
      <div class="list" id="move-options"></div>
      <div class="actions">
        <button id="move-cancel" type="button">Cancel</button>
        <button id="move-confirm" class="primary" type="button">Move</button>
      </div>
    </div>
  </div>

  <!-- toasts -->
  <div id="toasts"></div>

  <script src="./script.js"></script>
</body>
</html>
